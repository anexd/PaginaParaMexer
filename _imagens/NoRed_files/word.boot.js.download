var Microsoft="object"==typeof Microsoft?Microsoft:{};Microsoft.Office=Microsoft.Office||{},Microsoft.Office.Word=function(e){var i={};function t(o){if(i[o])return i[o].exports;var n=i[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}return t.m=e,t.c=i,t.d=function(e,i,o){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var n in e)t.d(o,n,function(i){return e[i]}.bind(null,n));return o},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},t.p="",t(t.s=0)}([function(e,i,t){"use strict";t.r(i);

var o=function(e,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var t in i)i.hasOwnProperty(t)&&(e[t]=i[t])})(e,i)};function n(e,i){function t(){this.constructor=e}o(e,i),e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)}var a,r,s,p,c,l,d=function(){return(d=Object.assign||function(e){for(var i,t=1,o=arguments.length;t<o;t++)for(var n in i=arguments[t])Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n]);return e}).apply(this,arguments)};function g(e){var i=e.indexOf("/",8);if(i<0)throw new Error("URL should contain a / after domain");var t=e.indexOf("/",i+1);if(t>=0)return e.substr(0,t+1);throw new Error("URL should contain a / after domain and folder")}function f(e,i){var t=e.indexOf("&"+i+"=");if(-1===t&&(t=e.indexOf("?"+i+"=")),-1===t)return"";var o=t+(i.length+2),n=e.indexOf("&",o);return-1===n?e.substr(o):e.substring(o,n)}function h(e){return e.replace(/^(.*?\/\/[^\/]*).*$/,"$1")}function u(e,i,t,o){if(void 0===o&&(o=!1),!t)return e;var n=e,a=n.indexOf("?"),r="&";a===n.length-1||"&"===n.slice(-1)||"&>"===n.slice(-2)?r="":-1===a&&(r="?");var s=i.toLowerCase()+"=",p=n.toLowerCase().indexOf(s,a);if("?"!==r&&p>=0){if(o){var c=n.indexOf("&",p);n=n.substring(0,p)+s+t+(-1===c?"":n.substring(c))}return n}return n.concat(r,s,t)}function m(e,i){var t=document.createElement("a");if(t.setAttribute("href",e),!t.hostname)throw new Error("Invalid URL. Cannot find domain");if(void 0===i)return t.hostname;if(i<0)throw new Error("subDomainParts should be at least 1");return t.hostname.split(".").slice(-(i+1)).join(".")}function w(e){if(null==e)return"";var i=-1===e.indexOf("#")?e.length:e.indexOf("#"),t=e.lastIndexOf("/",i);if(-1!==t&&t+1===e.indexOf("://")+"://".length)return"";t+=1;var o=e.indexOf("?");if(-1!==(o=o>=i?-1:o)&&t>o)return"";var n=-1===o?i:o;return t>=n?"":e.substring(t,n)}function P(e){return 8===e.toLowerCase().indexOf("ffc")}function S(e){return 8===e.toLowerCase().indexOf("ppc")}function F(e,i){return i&&i.Diagnostics?d({},e,i.Diagnostics):e}function I(e){return JSON.stringify(e,Object.getOwnPropertyNames(e))}function v(e,i,t){i.ULS.traceTag(596459999,r.WopiPendingApplication,t,"sessionTraces:"+JSON.stringify(e))}function C(e,i,t){t.Stop();var o=t.GetVisibilityChangeEvents();null!=o&&o.length>0&&(e.documentLoadedWithTabSwitch=!0,i.tabSwitchDiagnostics=JSON.stringify(o))}function y(e){try{if(void 0===window.performance)return void e.ULS.traceTag(595948609,r.WopiPendingApplication,s.Info,"TraceJsapiResourceTiming: performance not supported");var i=window.performance.getEntriesByType("resource");if(void 0===i||i.length<=0)return void e.ULS.traceTag(595948610,r.WopiPendingApplication,s.Info,"TraceJsapiResourceTiming: no resources under performance");for(var t=new RegExp("excel-boot.min.js|word.boot.js|visio.boot.js|onenote-boot.js","i"),o=0,n=i;o<n.length;o++){var a=n[o];if(t.test(a.name)){var p=JSON.stringify(a),c=w(a.name);return p=p.replace(new RegExp(a.name,"g"),c),void e.ULS.traceTag(595948616,r.WopiPendingApplication,s.Info,p)}}e.ULS.traceTag(595948484,r.WopiPendingApplication,s.Info,"TraceJsapiResourceTiming: could not find JSAPI resource timing entry")}catch(i){e.ULS.traceTag(595948617,r.WopiPendingApplication,s.Info,"TraceJsapiResourceTiming: could not trace the resource timing, error is: "+I(i))}}function A(e,i,t){if(e){var o="Page lifecycle: "+i+" fired.";o+=t?"Flushing ULS logger":"",e.ULS.traceTag(595957843,r.WopiPendingApplication,s.Info,o),t&&e.ULS.flush()}}function W(){if(null!=navigator&&null!=navigator.userAgent){var e=navigator.userAgent;if(e.indexOf("Firefox")>-1)return c.Firefox;if(e.indexOf("Opera")>-1)return c.Opera;if(e.indexOf("Trident")>-1)return c.IE;if(e.indexOf("Edge")>-1)return c.Edge;if(e.indexOf("Chrome")>-1)return c.Chrome;if(e.indexOf("Safari")>-1)return c.Safari}return c.Unknown}function T(){try{return navigator.userAgent.indexOf("iPad")>=0||navigator.userAgent.indexOf("Android")>=0||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}catch(e){return!1}}function b(){return W()===c.IE&&!function(){if(W()!==c.IE)return!1;if(null==document.documentMode||void 0===document.documentMode)return!1;return document.documentMode>=11}()}function U(e,i,t){void 0===t&&(t=!1);var o=i.required?i.applicationUrl:e.applicationUrl,n={jsApi:"1"};if(t&&(n.NewSession="1"),n.corrid=e.sessionId,n.usid=e.sessionId,(e.applicationCustomSettings&&e.applicationCustomSettings.IsCore||e.sessionInformation.IsCore)&&(n.core="1"),e.sessionInformation.DisableFocusOnBoot&&(n.disableFocusOnBoot="1"),e.sessionInformation.HighContrastMode&&(n.hcm=encodeURIComponent(e.sessionInformation.HighContrastMode)),e.sessionInformation.SupportsAccessibilityLoop&&(n.accloop="1"),e.sessionInformation.SupportsDocReboot){var a=e.sessionInformation.SupportsDocReboot;n.sdr=!0===a?"1":a.toString()}return e.sessionInformation.SupportsCreateNewDocument&&(n.scnd="1"),e.sessionInformation.HideHeader&&(n.hhdr="1"),e.applicationCustomSettings&&e.applicationCustomSettings.FixDiagnosticsJson&&(n.fixdiag="1"),e.wopiPrecheckInfo.ReadOnly&&(n.readOnly="1"),e.applicationCustomSettings&&e.applicationCustomSettings.InAppDocumentPreview&&(n.InAppDocPreview="1"),i.required?(i.singleFlushFallback&&(e.isCreateNew||(n.instantedit="1",n.wopicomplete="1")),n.wdRedirectionReason=i.reason):(n.instantedit="1",n.fileSrc=encodeURIComponent(e.sessionInformation.HostName),n.pmOrigin=encodeURIComponent(h(window.location.href)),e.isCreateNew&&(n.new="1",e.wopiPrecheckInfo.IsNewFileFromHostTemplate&&(n.wdTpl="fromhost"))),e.wopiPrecheckInfo.PreseededSessionKey&&(n.preseededSessionKey=encodeURIComponent(e.wopiPrecheckInfo.PreseededSessionKey)),e.wopiPrecheckInfo.PreseededWacSessionId&&(n.preseededWacSessionId=encodeURIComponent(e.wopiPrecheckInfo.PreseededWacSessionId)),e.applicationCustomSettings&&e.applicationCustomSettings.additionalApplicationParameters&&(n=d({},e.applicationCustomSettings.additionalApplicationParameters,n)),function(e,i,t,o,n){var a=function(e){var i={},t=e.indexOf("?");return-1===t||t===e.length-1?i:(e.substring(t+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach((function(e){if(e){var t=e.indexOf("=");-1!==t&&t!==e.length-1&&(i[e.substring(0,t).toLowerCase()]=e.substring(t+1))}})),i)}(e);"teams"!==a.uih&&"owa"!==a.uih||(a.hhdr="1","teams"===a.uih&&(a.jsapisr="1"));var r=e.indexOf("?"),s=-1===r?e.concat("?"):e.substring(0,r+1);i.UiLocale&&(a.ui=encodeURIComponent(i.UiLocale));i.DataLocale&&(a.rs=encodeURIComponent(i.DataLocale));i.HostSessionId&&(a.hid=encodeURIComponent(i.HostSessionId));i.DisableChat&&(a.dchat="1");i.SessionContext&&(a.sc=encodeURIComponent(i.SessionContext));t&&t.WopiSrc&&(a.wopisrc=encodeURIComponent(t.WopiSrc));i.CookieCompliant&&(a.mscc="1");o&&(o.entryPoint&&(a.wdorigin=encodeURI(o.entryPoint)),o.userClickTime&&(a.wdhostclicktime=o.userClickTime.toString()));a=d({},a,i.WdParams,n);var p={};for(var c in a)p[c.toLowerCase()]=a[c];var l=[];for(var c in p)p[c]&&l.push(c.concat("=",p[c]));return s.concat(l.join("&"))}(o,e.sessionInformation,e.wopiInfo,e.diagnostics.HostInitializeDiagnostics,n)}function M(e){return e.AccessTokenExpiry?e.AccessTokenExpiry.getTime().toString():"0"}!function(e){e.Unknown="Unknown",e.AppInitError="AppInitError",e.ApiDisabledError="ApiDisabledError",e.CannotLoadFirstPage="CannotLoadFirstPage",e.CannotLoadScript="CannotLoadScript",e.PageChangeError="PageChangeError",e.ZoomChangeError="ZoomChangeError",e.CannotLoadBundleItem="CannotLoadBundleItem",e.InvalidPageIndex="InvalidPageIndex",e.UnsupportedBundleVersion="UnsupportedBundleVersion",e.InvalidWopiInfo="InvalidWopiInfo",e.TimeoutWacReady="TimeoutWacReady",e.WacFailed="WacFailed"}(a||(a={})),function(e){e[e.ExcelEwaJs=0]="ExcelEwaJs",e[e.WordViewer=301]="WordViewer",e[e.WopiPendingApplication=379]="WopiPendingApplication",e[e.VisioApp=700]="VisioApp",e[e.PptSession=817]="PptSession"}(r||(r={})),(p=s||(s={}))[p.Spam=200]="Spam",p[p.Verbose=100]="Verbose",p[p.Info=50]="Info",p[p.Warning=15]="Warning",p[p.Error=10]="Error",function(e){e[e.Firefox=0]="Firefox",e[e.Opera=1]="Opera",e[e.IE=2]="IE",e[e.Edge=3]="Edge",e[e.Chrome=4]="Chrome",e[e.Safari=5]="Safari",e[e.Unknown=6]="Unknown"}(c||(c={})),function(e){e.ODC_H2StaticContent_Excel="Wac_HostFlight_H2StaticContent_Excel"}(l||(l={}));var L,O,E,k=5e3,R=1e3,x="WebApplicationFrame";function H(e,i,t,o,n){return function(e,i,t,o){!function(e,i){i[L.wacFrameComputedHeightPx]=String(e.offsetHeight),i[L.wacFrameComputedWidthPx]=String(e.offsetWidth),i[L.wacFrameTouchMode]=String(T()),i[L.wacFrameHighContrast]=String(function(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch(e){return!1}}())}(e,o);var n=i.ownerDocument,a=n.createElement("form");for(var r in a.id="office_form",a.name="office_form",a.action=t,a.target=e.name,a.method="POST",o){var s=n.createElement("input");s.type="hidden",s.name=r,s.value=o[r],a.appendChild(s)}return i.appendChild(a),a.submit(),e}(function(e,i,t,o,n){var a=e.ownerDocument.createElement("iframe");a.name=o||x,a.id=x,a.src="",a.title="Office Online Frame",a.width="100%",a.height="100%",a.marginWidth="0",a.marginHeight="0",a.style.left="0",a.style.top="0",a.style.right="0",a.style.bottom="0",a.style.display="block",a.style.position="absolute",a.style.backgroundColor="transparent",a.style.border="none",a.frameBorder="0",a.setAttribute("allowfullscreen","true"),a.setAttribute("allowTransparency","true"),t&&a.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation allow-popups-to-escape-sandbox");var r=h(i);return a.setAttribute("allow","microphone "+r+"; camera "+r+";"),n&&(a.onload=n),e.appendChild(a),a}(e,i,o,n),e,i,t)}function D(e,i){var t={};if(e.wopiInfo&&(t[L.wacFrameAccessToken]=e.wopiInfo.AccessToken,t[L.wacFrameAccessTokenTtl]=M(e.wopiInfo)),e.wopiPrecheckInfo.BundleInfo&&e.wopiPrecheckInfo.BundleInfo.Url&&e.wopiPrecheckInfo.BundleInfo.Url.length>0)if(t[L.wacFrameBundleSource]=e.wopiPrecheckInfo.BundleInfo.Url,null!=e.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==e.wopiPrecheckInfo.BundleInfo.BundleStaleness){var o=e.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();i.ULS.traceTag(595716227,r.WopiPendingApplication,s.Info,"BuildWacFramePostData: Content bundle staleness - "+o),t[L.wacFrameBundleStaleness]=o}else i.ULS.traceTag(595716228,r.WopiPendingApplication,s.Info,"BuildWacFramePostData: Content bundle staleness does not exit");if(e.wopiPrecheckInfo.FileGetUrl&&(t[L.wacFrameFileGetUrl]=e.wopiPrecheckInfo.FileGetUrl),e.wopiPrecheckInfo.FileName){var n=e.wopiPrecheckInfo.FileName.lastIndexOf(".");if(-1!==n){var a=e.wopiPrecheckInfo.FileName.substring(n+1);a&&(t[L.wacFrameFileExtension]=a)}t[L.wacFrameFileName]=e.wopiPrecheckInfo.FileName}return e.wopiPrecheckInfo.FileSize&&(t[L.wacFrameFileSize]=e.wopiPrecheckInfo.FileSize.toString()),e.sessionInformation.UserId&&(t[L.wacFrameUserId]=e.sessionInformation.UserId),e.sessionInformation.OwnerId&&(t[L.wacFrameOwnerId]=e.sessionInformation.OwnerId),e.sessionInformation.SessionContext&&(t[L.wacFrameSessionContext]=e.sessionInformation.SessionContext),e.diagnostics&&(t[L.wacFrameHostDiagnostics]=JSON.stringify(e.diagnostics)),e.featureManager&&(t[L.wacFrameFeatureStatus]=function(e){var i={};for(var t in l){var o=e.isFeatureEnabled(t);void 0!==o&&(i[t]=o?"1":"0")}return JSON.stringify(i)}(e.featureManager)),e.applicationCustomSettings&&e.applicationCustomSettings.HostUIControls&&(t[L.wacFrameHostUIControlOverrides]=JSON.stringify(e.applicationCustomSettings.HostUIControls)),t[L.wacFrameHighDpi]=String(window.devicePixelRatio>1.24),t[L.wacSoftBlockedBrowser]=String(b()),t[L.wacFrameHostName]=e.sessionInformation.HostName,t}!function(e){e.wacFrameAccessToken="access_token",e.wacFrameAccessTokenTtl="access_token_ttl",e.wacFrameBundleSource="bundleSrc",e.wacFrameBundleStaleness="bundleStaleness",e.wacFrameFileGetUrl="fileGetUrl",e.wacFrameFileExtension="fileExtension",e.wacFrameFileSize="fileSize",e.wacFrameFileName="fileName",e.wacFrameOwnerId="owner_id",e.wacFrameUserId="user_id",e.wacFrameSessionContext="sc",e.wacFrameHostDiagnostics="host_diagnostics",e.wacFrameHighDpi="highDpi",e.wacFrameComputedHeightPx="frameHeightPx",e.wacFrameComputedWidthPx="frameWidthtPx",e.wacFrameHostFlights="hostFlights",e.wacFrameHighContrast="highContrast",e.wacFrameTouchMode="touchMode",e.wacFrameHostUIControlOverrides="huictrls",e.wacSoftBlockedBrowser="softBlockedBrowser",e.wacFrameHostName="hostName",e.wacFrameFeatureStatus="feature_status"}(L||(L={})),function(e){e.Ack="Ack",e.SetZoomLevel="SetZoomLevel",e.SetCurrentPage="SetCurrentPage",e.UpdatePageCount="PageCount",e.FrameStateChanged="StateChanged",e.ZoomChangedAck="ZoomChanged_Ack",e.PageChangedAck="PageChanged_Ack",e.UpdatePageCountAck="PageCount_Ack",e.Error="Error",e.HostCacheDiagnostic="HostCacheDiagnostic",e.AppUnloaded="App_Unloaded",e.HostUnload="Host_Unload",e.DocumentReboot="App_DocReboot",e.SoftReboot="App_SoftReboot",e.WopiInfoFromUrlRequest="App_WopiInfoFromUrl",e.WopiInfoFromUrlResponse="Host_WopiInfoFromUrl",e.TrustFrameRequest="App_IsFrameTrusted",e.TrustFrameResponse="Host_IsFrameTrusted",e.fromWacFrameAppBootState="Wac_AppBootState",e.fromWacFrameInitReady="WacInitialize_Ready",e.fromWacFrameInitFrameLoaded="WacInitialize_FrameLoaded",e.fromWacFrameAppCompleted="Wac_AppCompleted",e.fromWacFrameAppCompletedAck="Wac_AppCompleted_Ack",e.fromWacFrameAppLoadingStatus="App_LoadingStatus",e.fromWacFrameAppFailed="Wac_AppFailed",e.fromWacFrameAppFailedAck="Wac_AppFailed_Ack",e.fromWacFrameSessionCompleteAck="WopiSession_Complete_Ack",e.toWacFrameFailSession="WopiPendingSession_Fail",e.toWacFrameInitReadyAck="WacInitialize_Ready_Ack",e.toWacFramePendingSessionComplete="WopiPendingSession_Complete",e.toWacFrameStartSessionComplete="WopiStartSession_Complete",e.toWacFrameJsApiDiagnostics="JsApiDiagnostics",e.toWacFramePendingAppCompleteReceived="WopiPendingApplicationComplete_Received"}(O||(O={})),function(e){e.AckExpected="ackExpected",e.NewZoomLevel="newLevel",e.NewPageNumber="newPage",e.PageCount="pageCount",e.IsDisabled="isDisabled",e.ErrorType="errorType",e.ErrorObject="errorObject"}(E||(E={}));var z=function(){function e(e,i,t,o,n,a,r,s){if(this.wacAppCompleteOrFailReceived=!1,this.fastFoodUlsPing=void 0,void 0===i)throw new TypeError("wopiFallbackInfo");if(i.required&&void 0===e.wopiInfo)throw new TypeError("wopiInfo");this.appParams=e,this.wopiFallbackInfo=i,this.logger=n,this.postMessenger=a,this.fnOnWopiBootSuccess=r,this.fnOnWopiBootFailure=s,this.appInitDiagnostics=t,this.sessionTraces=o,this.sessionTraces.wopiInitializeTime=Date.now()}return e.prototype.Boot=function(){var e=this;this.logger.ULS.traceTag(596444241,r.WopiPendingApplication,s.Info,"Initializing WAC frame");var i=U(this.appParams,this.wopiFallbackInfo,!0),t=D(this.appParams,this.logger);if(P(i)&&this.beginUlsPing(3e3,this.logger),this.postMessenger.registerMessagePayloadHandler(O.fromWacFrameAppBootState,(function(i){e.handleWacAppBootState(i)})),this.postMessenger.registerMessagePayloadHandler(O.TrustFrameRequest,(function(i){e.handleTrustFrameRequest(i)})),this.wopiFallbackInfo.ignoreWacFramePostMessages||this.populateWacFrameCompletedAndFailedHandlers(),this.bootWacFrame(i,t),this.wopiFallbackInfo.ignoreWacFramePostMessages){var o=this.getApplicationState();this.fnOnWopiBootSuccess(o)}return this.logger.ULS.traceTag(595661019,r.WopiPendingApplication,s.Info,"Created Wac Frame"),this.innerApplicationFrame},e.prototype.bootWacFrame=function(e,i){this.appInitDiagnostics.officeFrameCreateTime=Date.now(),this.sessionTraces.frameCreateStartTime=this.appInitDiagnostics.officeFrameCreateTime;var t=!(!this.appParams.sessionInformation.WdParams||!this.appParams.sessionInformation.WdParams.wdSandboxWacFrame),o=this.appParams.applicationCustomSettings&&this.appParams.applicationCustomSettings.appFrameName;this.appParams.fnCreatePragueFrame?this.innerApplicationFrame=this.appParams.fnCreatePragueFrame(this.appParams):this.innerApplicationFrame=H(this.appParams.container,e,i,t,o),this.postMessenger.setInnerApplicationFrame(this.innerApplicationFrame)},e.prototype.populateWacFrameCompletedAndFailedHandlers=function(){var e=this;this.postMessenger.registerMessagePayloadHandler(O.fromWacFrameAppCompleted,(function(i){e.handleWacCompleteMessage(i)})),this.postMessenger.registerMessagePayloadHandler(O.fromWacFrameAppFailed,(function(i){e.handleWacFailureMessage(i)})),window.setTimeout((function(){return e.timeoutWacAppCompleteOrFail()}),15e3)},e.prototype.handleWacAppBootState=function(e){var i=e&&e.state?e.state:"unknown";this.logger.ULS.traceTag(595714271,r.WopiPendingApplication,s.Info,"WAC Boot App state:["+i+"]")},e.prototype.handleTrustFrameRequest=function(e){var i=window===window.top||window.parent===window.top&&window.location.origin===window.top.origin;this.logger.ULS.traceTag(595653903,r.WopiPendingApplication,s.Info,"Top frame is trusted: "+i),this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,O.TrustFrameResponse,{isTopFrameTrusted:i})},e.prototype.handleWacCompleteMessage=function(e){if(this.wacAppCompleteOrFailReceived)this.logger.ULS.traceTag(596444234,r.WopiPendingApplication,s.Info,"Received multiple wac complete or failure messages");else{this.wacAppCompleteOrFailReceived=!0,this.sendWacPostMessage(O.fromWacFrameAppCompletedAck,{}),this.sendParentPostMessage(O.fromWacFrameAppCompleted,e),this.appInitDiagnostics=F(this.appInitDiagnostics,e),this.logger.ULS.traceTag(595986314,r.WopiPendingApplication,s.Info,"Received wac complete message");var i=this.getApplicationState();this.fnOnWopiBootSuccess(i),this.sendJsApiDiagnosticsToWacFrame(this.appParams.diagnostics),this.fastFoodUlsPing&&this.endUlsPing(),this.logger.ULS.flush()}},e.prototype.getApplicationState=function(){return{innerApplicationFrame:this.innerApplicationFrame}},e.prototype.handleWacFailureMessage=function(e){if(this.wacAppCompleteOrFailReceived)this.logger.ULS.traceTag(596444235,r.WopiPendingApplication,s.Info,"Received multiple wac complete or failure messages");else{this.wacAppCompleteOrFailReceived=!0,this.sendWacPostMessage(O.fromWacFrameAppFailedAck,{}),this.sendParentPostMessage(O.fromWacFrameAppFailed,e);var i={errorType:a.WacFailed,errorObject:{}};e&&(i.errorObject=e.Error,this.sessionTraces.error=i),this.logger.ULS.traceTag(595986315,r.WopiPendingApplication,s.Error,"Received wac failed message"),this.fnOnWopiBootFailure(i),this.fastFoodUlsPing&&this.endUlsPing(),this.logger.ULS.flush()}},e.prototype.timeoutWacAppCompleteOrFail=function(){this.wacAppCompleteOrFailReceived||this.logger.ULS.traceTag(596444236,r.WopiPendingApplication,s.Warning,"WopiPendingApplication.timeoutWacAppCompleteOrFail() sessionTraces:"+JSON.stringify(this.sessionTraces))},e.prototype.sendJsApiDiagnosticsToWacFrame=function(e){this.sendWacPostMessage(O.toWacFrameJsApiDiagnostics,e)},e.prototype.beginUlsPing=function(e,i){this.fastFoodUlsPing=window.setInterval((function(){i.ULS.traceTag(595724178,r.WopiPendingApplication,s.Info,"FastFood heartbeat ...")}),e)},e.prototype.endUlsPing=function(){window.clearInterval(this.fastFoodUlsPing)},e.prototype.sendWacPostMessage=function(e,i){this.innerApplicationFrame&&this.innerApplicationFrame.contentWindow?this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,e,i):this.logger.ULS.traceTag(595955718,r.WopiPendingApplication,s.Info,"Attempted to send postmessage: "+e)},e.prototype.sendParentPostMessage=function(e,i){window.parent!==window&&window.location.href.toLowerCase().indexOf("or=teams")>0&&this.postMessenger.sendPostMessage(window.parent,e,i)},e}(),B= "16.0.12229.37775",N=!1,_=!1;function V(){N=!1}function j(e,i,t,o,n){if(i&&i.ULS.traceTag(595714433,r.WopiPendingApplication,s.Info,"Starting disposing the application. unloadApp:"+e+";disposed:"+N+";unloading:"+_),N||_&&e)i&&i.ULS.traceTag(595714908,r.WopiPendingApplication,s.Info,"Application is already disposed or unloading");else{var a={logger:i,postMessenger:t,innerApplicationFrame:o,onDisposed:n,forceAppUnload:!1,disposeStartTime:Date.now(),appUnloadTimedOut:!1};if(e&&o)return _=!0,a.forceAppUnload=!0,void function(e){e.forceAppUnloadStartTime=Date.now(),e.logger&&(e.logger.ULS.traceTag(595855490,r.WopiPendingApplication,s.Info,"Sending postmessage to unload app"),e.logger.ULS.flush());e.postMessenger.registerMessagePayloadHandler(O.AppUnloaded,(function(i){return function(e,i){e.forceAppUnloadEndTime=Date.now(),e.appUnloadedMessageValues=i,e.logger&&e.logger.ULS.traceTag(595855491,r.WopiPendingApplication,s.Info,"AppUnloaded received from app"),q(e)}(e,i)})),e.postMessenger.sendPostMessage(e.innerApplicationFrame.contentWindow,O.HostUnload,{}),window.setTimeout((function(){return function(e){!_&&N||(e.appUnloadTimedOut=!0,e.logger&&e.logger.ULS.traceTag(595855492,r.WopiPendingApplication,s.Info,"ApplicationUnload timed out, forcing dispose"),q(e))}(e)}),R)}(a);q(a)}}function q(e){if(!N)try{N=!0,_=!1,function(e){if(!e.innerApplicationFrame)return;e.innerApplicationFrame.src="about:blank",window.setTimeout((function(){e.innerApplicationFrame&&e.innerApplicationFrame.parentElement&&e.innerApplicationFrame.parentElement.removeChild(e.innerApplicationFrame)}),0)}(e),function(e){if(!e.logger)return;var i={disposeStartTime:e.disposeStartTime,disposeEndTime:Date.now(),forceAppUnload:e.forceAppUnload,appUnloadTimedOut:e.appUnloadTimedOut};e.forceAppUnloadStartTime&&(i.appUnloadStartTime=e.forceAppUnloadStartTime);e.forceAppUnloadEndTime&&(i.appUnloadEndTime=e.forceAppUnloadEndTime);if(e.appUnloadedMessageValues){var t=e.appUnloadedMessageValues;void 0!==t.sendBeaconFlight&&(i.sendBeaconFlight=t.sendBeaconFlight),void 0!==t.sendBeaconSupported&&(i.sendBeaconSupported=t.sendBeaconSupported);var o=Number(t.hostMessageReceived);e.forceAppUnloadStartTime&&!isNaN(o)&&(i.hostToAppPostMessageLatency=o-e.forceAppUnloadStartTime);var n=Number(t.appMessageSent);!isNaN(n)&&e.forceAppUnloadEndTime&&(i.appToHostPostMessageLatency=e.forceAppUnloadEndTime-n);var a=Number(t.appUnloadStart),p=Number(t.appUnloadEnd);if(isNaN(a)||isNaN(p)||(i.appUnloadLatency=p-a),t.serverTimings){var c=t.serverTimings;for(var l in c)i["st-"+l.toString()]=c[l]}}e.logger.ULS.traceTag(595855436,r.WopiPendingApplication,s.Info,"App disposed "+JSON.stringify(i)),e.logger.ULS.flushOnClose()}(e),e.onDisposed&&e.onDisposed()}catch(i){e.logger&&e.logger.ULS.traceTag(595714434,r.WopiPendingApplication,s.Error,"Error disposing: "+I(i))}}var J,Z=function(){function e(e,i,t,o,n,a,r,s){var p=this;this.wacFrameIsLoaded=!1,this.initializeCompleted=!1,this.completeOrFailCalled=!1,this.sessionFailureReason=null,this.parallelizeStartSession=!0,this.wacAcceptsStartSessionComplete=!1,this.wacAppSessionCompletionMessageAck=!1,this.appParams=e,this.wopiFallbackInfo=i,this.appInitDiagnostics=t,this.logger=o,this.postMessenger=n,this.fnOnWopiBootSuccess=r,this.fnOnWopiBootFailure=s,this.sessionTraces=a,this.sessionTraces.wopiPendingInitializeTime=Date.now(),V(),window.setTimeout((function(){return p.timeoutCompleteOrFail()}),k)}return e.prototype.Complete=function(e,i){if(this.completeOrFailCalled)this.logger.ULS.traceTag(596444184,r.WopiPendingApplication,s.Warning,"Complete called after Complete/Fail already called");else{this.logger.ULS.traceTag(596444185,r.WopiPendingApplication,s.Info,"WopiPendingApplication.Complete() called."),this.completeOrFailCalled=!0,this.wopiInfo=e,this.sessionTraces.wopiPendingCompleteTime=Date.now();try{this.wopiFallbackInfo.required?this.completeFallbackFlow():this.completeInstantFlow(),this.wacFrameIsLoaded&&this.sendWacPostMessage(O.toWacFramePendingAppCompleteReceived,{}),this.updateBrowserHistoryForCreateNew(i)}catch(e){this.logger.ULS.traceTag(596444186,r.WopiPendingApplication,s.Error,"WopiPendingApplication.Complete() unexpected script error: "+I(e))}finally{this.logger.ULS.flush()}}},e.prototype.Fail=function(e){this.completeOrFailCalled?this.logger.ULS.traceTag(596444187,r.WopiPendingApplication,s.Warning,"Fail called after Complete/Fail already called"):(this.logger.ULS.traceTag(596444188,r.WopiPendingApplication,s.Warning,"WopiPendingApplication.Fail() called. Reason: "+(e?JSON.stringify(e):"N/A")),this.completeOrFailCalled=!0,this.wopiFallbackInfo.required?this.failFallbackFlow():this.failInstantFlow(e),this.logger.ULS.flush())},e.prototype.Dispose=function(e,i){var t=this;j(e||!1,this.logger,this.postMessenger,this.innerApplicationFrame,(function(){delete t.innerApplicationFrame,i&&i()}))},e.prototype.Boot=function(){this.wopiFallbackInfo.required||this.bootInstantFlow(),this.logger.ULS.flush()},e.prototype.bootInstantFlow=function(){var e=this;this.logger.ULS.traceTag(596444231,r.WopiPendingApplication,s.Info,"Initializing Office frame WITHOUT WOPI info available - first step of instant boot flow."),window.setTimeout((function(){return e.timeoutWacReadyMessage()}),5e3),this.populateWacFrameEventHandlersForInstantBoot();var i=new z(this.appParams,this.wopiFallbackInfo,this.appInitDiagnostics,this.sessionTraces,this.logger,this.postMessenger,this.fnOnWopiBootSuccess,this.fnOnWopiBootFailure);this.innerApplicationFrame=i.Boot()},e.prototype.populateWacFrameEventHandlersForInstantBoot=function(){var e=this;this.postMessenger.registerMessagePayloadHandler(O.fromWacFrameInitReady,(function(i){e.handleWacReadyMessage(i)})),this.postMessenger.registerMessagePayloadHandler(O.fromWacFrameInitFrameLoaded,(function(i){e.handleWacFrameLoadedMessage(i)})),this.postMessenger.registerMessagePayloadHandler(O.fromWacFrameSessionCompleteAck,(function(i){e.handleWacFrameSessionCompleteAckMessage(i)}))},e.prototype.completeInstantFlow=function(){var e={ParallelizeStartSession:this.parallelizeStartSession,WacFrameIsLoaded:this.wacFrameIsLoaded,WacAcceptsStartSessionComplete:this.wacAcceptsStartSessionComplete};this.logger.ULS.traceTag(596444232,r.WopiPendingApplication,s.Info,"Completing the Office initialized application WITH the WOPI info - second step of instant boot flow. Current app state - "+JSON.stringify(e)),!this.parallelizeStartSession||this.wacFrameIsLoaded&&!this.wacAcceptsStartSessionComplete?this.wacFrameIsLoaded&&this.sendWopiInfoToWacFrame():this.makeStartSessionRequest()},e.prototype.completeFallbackFlow=function(){this.logger.ULS.traceTag(596444233,r.WopiPendingApplication,s.Info,"Initializing Office frame WITH WOPI info available - single step of WOPI boot flow."),this.appParams.wopiInfo=this.wopiInfo;var e=new z(this.appParams,this.wopiFallbackInfo,this.appInitDiagnostics,this.sessionTraces,this.logger,this.postMessenger,this.fnOnWopiBootSuccess,this.fnOnWopiBootFailure);this.innerApplicationFrame=e.Boot()},e.prototype.failInstantFlow=function(e){this.wacFrameIsLoaded?(this.logger.ULS.traceTag(595968481,r.WopiPendingApplication,s.Warning,"Fail called and wacframe is able to accept postmessages"),this.sendFailurePostMessageToWacFrame(e)):(this.logger.ULS.traceTag(595968482,r.WopiPendingApplication,s.Warning,"Fail was called on the session prior to WacReady."),this.sessionFailureReason=e)},e.prototype.sendFailurePostMessageToWacFrame=function(e){this.logger.ULS.traceTag(596444189,r.WopiPendingApplication,s.Warning,"Fail called, sending the failure postmessage to IFrame"),this.sendWacPostMessage(O.toWacFrameFailSession,e)},e.prototype.failFallbackFlow=function(){this.logger.ULS.traceTag(596444190,r.WopiPendingApplication,s.Warning,"Fail called during Fallback Boot, calling host failure callback..."),this.fnOnWopiBootFailure({errorType:a.InvalidWopiInfo,errorObject:new TypeError("wopiInfo")})},e.prototype.timeoutWacReadyMessage=function(){this.wacFrameIsLoaded||(this.logger.ULS.traceTag(596444191,r.WopiPendingApplication,s.Warning,"WopiPendingApplication.timeoutWacReadyMessage()"),this.fnOnWopiBootFailure({errorType:a.TimeoutWacReady,errorObject:void 0}))},e.prototype.timeoutCompleteOrFail=function(){this.completeOrFailCalled||(this.sessionTraces.timeoutCompleteOrFail=Date.now(),this.logger.ULS.traceTag(596444192,r.WopiPendingApplication,s.Warning,"WopiPendingApplication.timeoutCompleteOrFail() sessionTraces:"+JSON.stringify(this.sessionTraces)))},e.prototype.timeoutWacSessionCompletionMessageAck=function(e,i,t){this.wacAppSessionCompletionMessageAck||(this.logger.ULS.traceTag(596444193,r.WopiPendingApplication,s.Info,"SessionCompletion timed out with no ack."),this.sendSessionCompletionMessageWithRetryHelper(e,i,t+1))},e.prototype.handleWacReadyMessage=function(e){if(this.sessionTraces.readyMessageReceiveTime=Date.now(),this.sendWacPostMessage(O.toWacFrameInitReadyAck,{}),this.wacFrameIsLoaded)this.logger.ULS.traceTag(596444194,r.WopiPendingApplication,s.Info,"Received multiple ready messages - frame is already loaded.");else{this.wacFrameIsLoaded=!0,this.wacAcceptsStartSessionComplete=e&&e.CanAcceptStartSessionComplete;var i={AcceptStartSessionComplete:this.wacAcceptsStartSessionComplete,ParallelizeStartSession:this.parallelizeStartSession,StartSessionResponse:null!=this.startSessionResponse,WopiInfo:null!=this.wopiInfo};this.logger.ULS.traceTag(596444195,r.WopiPendingApplication,s.Info,"HandleWacReadyMessage - "+JSON.stringify(i)),this.completeOrFailCalled&&(this.sessionFailureReason?this.sendFailurePostMessageToWacFrame(this.sessionFailureReason):this.sendWacPostMessage(O.toWacFramePendingAppCompleteReceived,{})),this.parallelizeStartSession&&this.wacAcceptsStartSessionComplete?this.startSessionResponse&&this.startSessionCompleted():this.wopiInfo&&this.sendWopiInfoToWacFrame(),this.appInitDiagnostics=F(this.appInitDiagnostics,e)}},e.prototype.handleWacFrameLoadedMessage=function(e){this.appInitDiagnostics=F(this.appInitDiagnostics,e)},e.prototype.handleWacFrameSessionCompleteAckMessage=function(e){this.wacAppSessionCompletionMessageAck=!0,this.sessionTraces.sessionCompleteAckReceivedTime=Date.now()},e.prototype.sendWacPostMessage=function(e,i){this.innerApplicationFrame&&this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,e,i)},e.prototype.sendSessionCompletionMessageWithRetry=function(e,i){this.sendSessionCompletionMessageWithRetryHelper(e,i,1)},e.prototype.sendSessionCompletionMessageWithRetryHelper=function(e,i,t){var o=this;if(t>3)this.logger.ULS.traceTag(596444224,r.WopiPendingApplication,s.Error,"Attempted to call complete, but received no ack from the frame. Time: "+Date.now());else{this.logger.ULS.traceTag(596444225,r.WopiPendingApplication,s.Info,"Sending completion message to frame. Attempt number: "+t+", Time: "+Date.now());var n=Date.now();1===t&&(this.startSessionResponse&&this.startSessionResponse.Diagnostics&&(this.startSessionResponse.Diagnostics.completeMessageCreateTime=n),this.sessionTraces.completeMessageCreateTime=n),i.Diagnostics.completeMessageSendTime=n,this.sessionTraces.completeMessageSendTime=n,this.sendWacPostMessage(e,i),window.setTimeout((function(){return o.timeoutWacSessionCompletionMessageAck(e,i,t)}),1e3)}},e.prototype.makeStartSessionRequest=function(){var e=this;this.logger.ULS.traceTag(596444226,r.WopiPendingApplication,s.Info,"Making parallelized startSession request.");var i=this.buildStartSessionUrl(this.wopiInfo),t={"Content-Type":"application/x-www-form-urlencoded"},o="access_token="+encodeURIComponent(this.wopiInfo.AccessToken)+"&access_token_ttl="+encodeURIComponent(M(this.wopiInfo));this.sessionTraces.startSessionStartTime=Date.now(),function(e,i,t,o){var n=new XMLHttpRequest;for(var a in n.onreadystatechange=function(){if(n&&4===n.readyState){if(void 0===n.status||0===n.status)return;try{o&&o(n)}finally{null!=n&&(n.onreadystatechange=function(){})}}},n.open("POST",e),t)n.setRequestHeader(a,t[a]);n.send(i)}(i,o,t,(function(i){return e.onStartSessionRequestCompleted(i)}))},e.prototype.onStartSessionRequestCompleted=function(e){if(this.sessionTraces.startSessionCompleteTime=Date.now(),this.sessionTraces.startSessionResponseStatus=e.status,this.startSessionResponse={StartSessionResponse:{RequestStatus:e.status,ResponseText:e.responseText},Diagnostics:{wopiPendingInitializeTime:this.sessionTraces.wopiPendingInitializeTime,wopiPendingCompleteTime:this.sessionTraces.wopiPendingCompleteTime,startSessionStartTime:this.sessionTraces.startSessionStartTime,startSessionCompleteTime:this.sessionTraces.startSessionCompleteTime,readyMessageReceiveTime:this.sessionTraces.readyMessageReceiveTime}},this.logger.ULS.traceTag(596444227,r.WopiPendingApplication,s.Info,"StartSession request completed with status code: "+this.startSessionResponse.StartSessionResponse.RequestStatus+", Time: "+Date.now()),this.wacFrameIsLoaded&&this.wacAcceptsStartSessionComplete)this.startSessionCompleted();else{var i={WacFrameIsLoaded:this.wacFrameIsLoaded,InitializeCompleted:this.initializeCompleted};this.logger.ULS.traceTag(596444228,r.WopiPendingApplication,s.Info,"StartSessionCompleted not called - "+JSON.stringify(i))}},e.prototype.sendWopiInfoToWacFrame=function(){if(!this.initializeCompleted){this.initializeCompleted=!0,this.logger.ULS.traceTag(596444229,r.WopiPendingApplication,s.Info,"Sending wopi info to the frame.");var e={WopiDetails:{WopiSrc:this.wopiInfo.WopiSrc,AccessToken:this.wopiInfo.AccessToken,AccessTokenTtl:M(this.wopiInfo)},Diagnostics:{wopiPendingInitializeTime:this.sessionTraces.wopiPendingInitializeTime,wopiPendingCompleteTime:this.sessionTraces.wopiPendingCompleteTime,readyMessageReceiveTime:this.sessionTraces.readyMessageReceiveTime}};this.sendSessionCompletionMessageWithRetry(O.toWacFramePendingSessionComplete,e)}},e.prototype.startSessionCompleted=function(){200===this.startSessionResponse.StartSessionResponse.RequestStatus?this.initializeCompleted||(this.initializeCompleted=!0,this.sendSessionCompletionMessageWithRetry(O.toWacFrameStartSessionComplete,this.startSessionResponse)):this.sendWopiInfoToWacFrame()},e.prototype.buildStartSessionUrl=function(e){var i=this.appParams.applicationBaseUrl+"wordeditorstartsession.ashx",t=U(this.appParams,this.wopiFallbackInfo,!1);return i=u(i+="?"+t.substring(t.indexOf("?")+1),"WOPISrc",encodeURIComponent(e.WopiSrc)),i=u(i,"build",encodeURIComponent(B)),i=u(i,"WacUserType",encodeURIComponent("WOPI")),this.appParams.wopiPrecheckInfo.FileGetUrl&&(i=u(i,"fileGetUrlPresent","1")),i},e.prototype.updateBrowserHistoryForCreateNew=function(e){if(this.appParams.isCreateNew){if(!e||!e.NewFilePath)return void this.logger.ULS.traceTag(596444230,r.WopiPendingApplication,s.Error,"Either NewFileInfo or NewFilePath are not provided for a new file.");history.replaceState({},"",e.NewFilePath),e.UpdatedPageTitle&&(document.title=e.UpdatedPageTitle)}},e}();!function(e){e.BrowserEvent="BrowserEvent",e.PageChanged="PageChanged",e.ZoomChanged="ZoomChanged",e.ContentRefreshBegin="ContentRefreshBegin",e.ContentRefreshEnd="ContentRefreshEnd",e.AppClosed="UI_Close",e.UserEdit="Edit_Notification",e.FileRename="File_Rename",e.FileShare="UI_Sharing",e.ShowFileVersions="UI_FileVersions",e.UIWorkflow="UI_Workflow",e.IsDisabled="IsDisabled",e.AccessibilityLoopComplete="App_AccessibilityLoopComplete",e.Unloaded="Unloaded",e.SwitchMode="App_SwitchMode",e.DocumentReboot="DocReboot",e.WopiInfoFromUrl="WopiInfoFromUrl"}(J||(J={}));var G,K=function(){function e(e,i,t,o,n,a,r,s,p){this.wacCompleteMessageReceived=!1,this.appInitializeComplete=!1,this.isMobile=!1,this.appInitializeTimeoutInMs=6e4,this.appParams=e,this.wopiFallbackInfo=i,this.appInitDiagnostics=t,this.logger=o,this.postMessenger=n,this.visibilityMetrics=a,this.sessionTraces=r;var c=window.navigator.userAgent;c.indexOf("Mobi")>=0&&c.indexOf("iPad")<0&&(this.isMobile=!0),this.fnOnWopiBootSuccess=s,this.fnOnWopiBootFailure=p,this.fnOnWopiBootSuccessProxy=this.isMobile?s:this.getSuccessCallbackProxy(),this.fnOnWopiBootFailureProxy=this.isMobile?p:this.getFailureCallbackProxy(),this.isCore=!(!this.appParams.applicationCustomSettings||!this.appParams.applicationCustomSettings.IsCore),this.appParams.sessionInformation&&this.appParams.sessionInformation.WdParams&&(this.appParams.applicationCustomSettings&&this.appParams.applicationCustomSettings.ForceAccessibilityMode?this.appParams.sessionInformation.WdParams.wdAccPdf="1":this.isCore&&(this.appParams.sessionInformation.WdParams.wdAccPdf="0")),this.wopiPendingInitializer=new Z(this.appParams,i,t,o,n,r,this.fnOnWopiBootSuccessProxy,this.fnOnWopiBootFailureProxy)}return e.prototype.Complete=function(e){this.appParams.diagnostics.HostInitializeDiagnostics&&(this.appParams.diagnostics.HostInitializeDiagnostics.hostCompleteCallTime=Date.now()),this.wopiPendingInitializer.Complete(e)},e.prototype.Fail=function(e){this.wopiPendingInitializer.Fail(e)},e.prototype.Dispose=function(e,i){var t=this;j(e||!1,this.logger,this.postMessenger,this.innerApplicationFrame,(function(){delete t.innerApplicationFrame,i&&i()}))},e.prototype.Boot=function(){var e=this;this.visibilityChangeHandler=this.handleVisibilityChange.bind(this),this.visibilityMetrics.RegisterEventHandler(this.visibilityChangeHandler),this.isMobile?this.logger.ULS.traceTag(595932544,r.WordViewer,s.Info,"Mobile Endpoint detected, skipping first page viewer optimization"):(this.logger.ULS.traceTag(595989253,r.WordViewer,s.Info,"Boot WordViewer"),this.postMessenger.registerMessagePayloadHandler(O.UpdatePageCount,(function(i){e.handleWacPageCountInit(i)})),this.postMessenger.registerMessagePayloadHandler(J.PageChanged,(function(i){e.handleWacCurrentPageInit(i)})),this.postMessenger.registerMessagePayloadHandler(J.ZoomChanged,(function(i){e.handleWacZoomLevelInit(i)})),this.appParams.wopiPrecheckInfo.BundleInfo?this.kickOffFirstPageOptimization(this.appParams.wopiPrecheckInfo.BundleInfo,this.appParams.container,(function(){e.firstPageOptimizationLoadTime=Date.now(),e.logger.ULS.traceTag(595998873,r.WordViewer,s.Info,"FirstPageFromHostLoadTime: "+e.firstPageOptimizationLoadTime),e.appInitDiagnostics.documentLoadedTime=e.appInitDiagnostics.documentLoadedTime||e.firstPageOptimizationLoadTime,e.innerApplicationFrame&&e.innerApplicationFrame.contentWindow&&e.postFastBootOptimizationTime(e.innerApplicationFrame.contentWindow,e.firstPageOptimizationLoadTime)}),(function(i){e.removeFirstPageContainer(),e.logger.ULS.traceTag(595994571,r.WordViewer,s.Warning,"Cannot load first page from cache"),e.appInitDiagnostics.errorObject=i})):this.logger.ULS.traceTag(596121033,r.WordViewer,s.Warning,"Missing Bundle Info"),window.setTimeout((function(){return e.timeoutAppInitialize()}),this.appInitializeTimeoutInMs))},e.prototype.postFastBootOptimizationTime=function(e,i){this.postMessenger.sendPostMessage(e,O.HostCacheDiagnostic,{HostCacheLoadTime:i})},e.prototype.kickOffFirstPageOptimization=function(e,i,t,o){var n=this;if(this.logger.ULS.traceTag(595989254,r.WordViewer,s.Info,"Kick off OptimizationView"),!this.appParams.applicationCustomSettings||!this.appParams.applicationCustomSettings.ForceAccessibilityMode)if(e.Url){var p=i.ownerDocument;this.firstPageContainer=p.createElement("div"),this.firstPageContainer.id="FirstPageContainer",this.firstPageContainer.style.left="0",this.firstPageContainer.style.textAlign="center",this.firstPageContainer.style.width="1px",this.firstPageContainer.style.bottom="0",this.firstPageContainer.style.zIndex="900",this.firstPageContainer.style.height="1px",this.firstPageContainer.style.position="absolute",this.firstPageContainer.style.padding="0 29px",this.firstPageContainer.style.right="0",this.firstPageContainer.style.overflow="auto",this.firstPageContainer.style.marginLeft="auto",this.firstPageContainer.style.marginRight="auto",this.firstPageContainer.style.maxWidth="100%",this.isCore?this.firstPageContainer.style.top="0":this.firstPageContainer.style.top="90px",i.appendChild(this.firstPageContainer);var c=p.createElement("img");c.id="FirstPageImage",c.style.marginTop="11px",c.style.marginBottom="11px",c.style.maxWidth="100%",c.style.border="solid 1px #d2d5d8",c.draggable=!1,c.onload=function(){n.logger.ULS.traceTag(595989255,r.WordViewer,s.Info,"OptimizationView Loaded"),n.firstPageContainer.style.width="",n.firstPageContainer.style.height="",t()},c.onerror=function(e){o({errorType:a.CannotLoadFirstPage,errorObject:e.returnValue})},c.src=e.Url.replace("{0}","p1.img"),this.firstPageContainer.appendChild(c)}else this.logger.ULS.traceTag(595722645,r.WordViewer,s.Info,"Missing Url in provided Bundle Info, from host: "+this.appParams.sessionInformation.HostName)},e.prototype.tryInitializeApplication=function(){if(!this.appInitializeComplete&&this.wacCompleteMessageReceived&&(!this.isCore||this.currentPage&&this.pageCount&&this.zoomLevel)){this.postMessenger.removeMessageHandler(O.UpdatePageCount),this.postMessenger.removeMessageHandler(J.PageChanged),this.postMessenger.removeMessageHandler(J.ZoomChanged),this.visibilityMetrics.RemoveEventHandler(this.visibilityChangeHandler);var e={isCore:this.isCore,pageCount:this.pageCount,currentPage:this.currentPage,zoomLevel:this.zoomLevel,innerApplicationFrame:this.innerApplicationFrame};this.fnOnWopiBootSuccess(e),this.logger.ULS.traceTag(595989256,r.WordViewer,s.Info,"Word Viewer Initialize Complete"),this.appInitializeComplete=!0,this.logger.ULS.flush()}},e.prototype.getSuccessCallbackProxy=function(){var e=this;return function(i){e.logger.ULS.traceTag(595986312,r.WordViewer,s.Info,"SuccessCallbackProxy called"),e.innerApplicationFrame=i.innerApplicationFrame,e.innerApplicationFrame&&e.innerApplicationFrame.contentWindow&&e.firstPageOptimizationLoadTime&&e.postFastBootOptimizationTime(e.innerApplicationFrame.contentWindow,e.firstPageOptimizationLoadTime),e.removeFirstPageContainer();var t=e.appInitDiagnostics.documentLoadedTime;t&&e.firstPageOptimizationLoadTime&&e.firstPageOptimizationLoadTime<t?(e.appInitDiagnostics.documentLoadedTime=e.firstPageOptimizationLoadTime,e.appInitDiagnostics.documentLoadedFromWopiPrecheckInfo=!0,e.logger.ULS.traceTag(595994572,r.WordViewer,s.Info,"First page load from cache was faster")):e.appInitDiagnostics.documentLoadedFromWopiPrecheckInfo=!1,e.sendAckMessages(),e.wacCompleteMessageReceived=!0,e.logger.ULS.traceTag(595986313,r.WordViewer,s.Info,"WordViewerInitializer received wac complete message"),e.tryInitializeApplication(),e.logger.ULS.flush()}},e.prototype.getFailureCallbackProxy=function(){var e=this;return function(i){e.logger.ULS.traceTag(595972122,r.WordViewer,s.Error,"FailureCallbackProxy called"),e.appInitializeComplete=!0,e.visibilityMetrics.RemoveEventHandler(e.visibilityChangeHandler),e.fnOnWopiBootFailure(i)}},e.prototype.removeFirstPageContainer=function(){this.firstPageContainer&&this.firstPageContainer.parentElement&&this.firstPageContainer.parentElement.removeChild(this.firstPageContainer)},e.prototype.timeoutAppInitialize=function(){if(!this.appInitializeComplete){this.sessionTraces.timeoutAppInitialize=Date.now();var e="Didn't receive app initialize post messages. {'appComplete': "+this.wacCompleteMessageReceived+", 'currentPage': "+(void 0!==this.currentPage)+", 'zoomLevel': "+(void 0!==this.zoomLevel)+", 'pageCount': "+(void 0!==this.pageCount)+"}";this.logger.ULS.traceTag(596120771,r.WordViewer,s.Warning,e)}},e.prototype.handleWacPageCountInit=function(e){if(!e||"number"!=typeof e[E.PageCount])throw new TypeError("values: PageCount not found");this.pageCount=e[E.PageCount],this.sendWacPostMessage(O.UpdatePageCountAck,{}),this.tryInitializeApplication()},e.prototype.handleWacCurrentPageInit=function(e){if(!e||"number"!=typeof e[E.NewPageNumber])throw new TypeError("values: CurrentPage not found");this.currentPage=e[E.NewPageNumber],this.sendWacPostMessage(O.PageChangedAck,{}),this.tryInitializeApplication()},e.prototype.handleWacZoomLevelInit=function(e){if(!e||"number"!=typeof e[E.NewZoomLevel])throw new TypeError("values: ZoomLevel not found");this.zoomLevel=e[E.NewZoomLevel],this.sendWacPostMessage(O.ZoomChangedAck,{}),this.tryInitializeApplication()},e.prototype.handleVisibilityChange=function(e){var i="Document visibility changed: "+e.visibility;this.logger.ULS.traceTag(595970189,r.WordViewer,s.Info,i)},e.prototype.sendAckMessages=function(){this.currentPage&&this.sendWacPostMessage(O.PageChangedAck,{}),this.pageCount&&this.sendWacPostMessage(O.UpdatePageCountAck,{}),this.zoomLevel&&this.sendWacPostMessage(O.ZoomChangedAck,{})},e.prototype.sendWacPostMessage=function(e,i){this.innerApplicationFrame&&this.innerApplicationFrame.contentWindow?this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,e,i):this.logger.ULS.traceTag(595955717,r.WordViewer,s.Info,"Attempted to send WordViewer postmessage: "+e)},e}();!function(e){e.wopiInfoByUrl="wopiInfoByUrl"}(G||(G={}));var X={};X[G.wopiInfoByUrl]=O.WopiInfoFromUrlResponse;var $,Q=function(){function e(e,i){var t=this;if(this.isFastfood=!1,this.isMsit=!1,this.eventHandlers={},!e)throw new Error("Missing origin for PostMessageHandler");this.isFastfood=P(e),this.isMsit=S(e),this.logger=i,this.setOrigin(e),window.addEventListener("message",(function(e){return t.handleWacFramePostMessage(e)}),!1)}return e.prototype.registerMessagePayloadHandler=function(e,i){if(this.eventHandlers[e])throw new Error("Duplicate registration!");this.eventHandlers[e]=i},e.prototype.removeMessageHandler=function(e){delete this.eventHandlers[e]},e.prototype.sendPostMessage=function(e,i,t){if(e){this.logger.ULS.traceTag(596464334,r.WopiPendingApplication,s.Info,"PostMessageHandler - Sending message: "+i);var o={MessageId:i,SendTime:Date.now(),Values:t};this.sendPostMessageInternal(e,JSON.stringify(o),this.origin)}else this.logger.ULS.traceTag(595948308,r.WopiPendingApplication,s.Info,"Missing target for SendPostMessage")},e.prototype.setInnerApplicationFrame=function(e){this.innerApplicationFrame=e},e.prototype.postMessageForCommand=function(e,i,t){var o=function(e){return X[e]}(i);o?(this.logger.ULS.traceTag(595702598,r.WopiPendingApplication,s.Info,"PostCommand: Sending message "+o+" for command "+i),this.sendPostMessage(e,o,t)):this.logger.ULS.traceTag(595702599,r.WopiPendingApplication,s.Warning,"PostCommand: No mapping for command "+i)},e.prototype.dispose=function(){for(var e=0,i=Object.keys(this.eventHandlers);e<i.length;e++){var t=i[e];delete this.eventHandlers[t]}},e.prototype.sendAckBack=function(e,i,t){if(e){var o={MessageId:O.Ack,CorrelationId:t,SendTime:Date.now()};this.logger.ULS.traceTag(595732176,r.WopiPendingApplication,s.Info,"Sending Ack back"),e.postMessage(JSON.stringify(o),i)}else this.logger.ULS.traceTag(595736136,r.WopiPendingApplication,s.Info,"Missing target to send Ack back")},e.prototype.handleWacFramePostMessage=function(e){var i=!1,t=!1,o="",n=!1;if(this.innerApplicationFrame&&this.innerApplicationFrame.contentWindow&&(i=!0,t=e.source===this.innerApplicationFrame.contentWindow),e.origin&&(n=(o=m(e.origin,2).toLowerCase())===this.receivingDomain),!this.isFastfood&&(!this.isMsit||n&&t)||this.logger.ULS.traceTag(595730526,r.WopiPendingApplication,s.Info,"Window is available: "+i+", window is valid: "+t+", origin is valid: "+n+", expected origin: "+this.receivingDomain+", actual origin: "+o),t||n){var a;try{a=JSON.parse(e.data)}catch(i){return this.logger.ULS.traceTag(596464282,r.WopiPendingApplication,s.Info,"PostMessageHandler - failed to parse event data: "+I(i)+"."),void(this.isFastfood&&this.logger.ULS.traceTag(595732175,r.WopiPendingApplication,s.Info,"string"==typeof e.data?"Length of event data: "+e.data.length+". First 200 characters of event data: "+e.data.substring(0,200):"Event data: "+JSON.stringify(e.data)))}var p=a.MessageId;if(p){this.logger.ULS.traceTag(595714715,r.WopiPendingApplication,s.Info,"PostMessageHandler: received messageId: "+p),p!==O.fromWacFrameAppCompleted&&p!==O.fromWacFrameAppLoadingStatus||this.setOrigin(e.origin),a.Values&&a.Values[E.AckExpected]&&this.sendAckBack(e.source,e.origin,a.CorrelationId);var c=this.eventHandlers[p];c?(this.logger.ULS.traceTag(596464288,r.WopiPendingApplication,s.Info,"PostMessageHandler - processing message: "+p),c(a.Values||{})):this.logger.ULS.traceTag(596464289,r.WopiPendingApplication,s.Info,"PostMessageHandler - no handler found for message id: "+p)}else(this.isFastfood||this.isMsit)&&this.logger.ULS.traceTag(595730520,r.WopiPendingApplication,s.Info,"Could not find message id")}},e.prototype.sendPostMessageInternal=function(e,i,t){e.postMessage(i,t)},e.prototype.setOrigin=function(e){var i=e.toLowerCase();this.origin&&this.origin!==i&&this.logger.ULS.traceTag(596128131,r.WopiPendingApplication,s.Warning,"PostMessageHandler - updating origin"),this.origin=i,this.receivingDomain=m(i,2),this.isFastfood=P(i),this.isMsit=S(i)},e}();function Y(e,i,t,o){var n=e.map((function(e){return function(e,i){var t={};t.G=e.tag,t.T=e.timestamp-i,t.M=e.message,t.C=e.category;var o=e.type*ee+e.level;return t.D=o,t}(e,o)})),a=function(e,i,t,o){var n={};return n.T=e,n.L=i,n.S=t,n.I=o,n.V=1,n}(o,n,i,t);return JSON.stringify(a)}!function(e){e[e.Trace=0]="Trace",e[e.Assert=1]="Assert"}($||($={}));var ee=1e3;var ie=function(){function e(i,t){var o=this;this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.isFastFood=!1,this.flushOnClose=function(){o.triggerUpload(!1,!1)},this.flush=function(){o.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout((function(){return o.triggerUpload(!0,!0)}),0)},this.triggerUpload=function(i,t){(window.clearTimeout(o.timeoutId),o.logCache.length>0)&&(o.uploadId+=1,function(e,i,t){if(""!==i)if(navigator&&navigator.sendBeacon)navigator.sendBeacon(i,e);else{var o=new XMLHttpRequest;o.readyState!==XMLHttpRequest.UNSENT&&o.readyState!==XMLHttpRequest.DONE||(o.open("POST",i,t),o.send(e))}}(Y(o.logCache,o.userSessionId,o.uploadId,o.timestampBase),o.remoteUrlEndpoint,t),o.logCache=[],o.timestampBase=Date.now());i&&(o.timeoutId=window.setTimeout(o.triggerUploadAsync,e.uploadCadenceInMsSec))},this.isFastFood=P(t),this.isFastFood&&(e.uploadCadenceInMsSec=5e3,e.uploadTriggerSize=10),this.userSessionId=i,this.remoteUrlEndpoint=t+"?usid="+i,window.setTimeout((function(){return o.triggerUpload(!0,!0)}),0)}return e.prototype.handleTrace=function(i){i.message.length>e.messageMaxChars&&(i.message=i.message.substr(0,e.messageMaxChars-e.trimedMessage.length)+e.trimedMessage),this.logCache.push(i),(this.logCache.length>e.uploadTriggerSize||i.level===s.Error)&&this.triggerUploadAsync()},e.messageMaxChars=3072,e.uploadCadenceInMsSec=3e4,e.uploadTriggerSize=30,e.trimedMessage="... [Trimmed]",e}(),te={getLogger:function(e,i){var t=new ie(e,i);return{ULS:{trace:function(e,i,o){return ne(t,0,e,i,o)},traceTag:function(e,i,o,n){return ne(t,e,i,o,n)},flush:t.flush,flushOnClose:t.flushOnClose}}}};var oe=s.Info;function ne(e,i,t,o,n){if(!(o>oe)){var a={timestamp:Date.now(),category:t,tag:i,level:o,type:$.Trace,message:n};e.handleTrace(a)}}var ae,re=[],se=function(){function e(e){this.eventHandlers=[],this.initialize(e)}return e.prototype.initialize=function(e){if("hidden"===document.visibilityState){var i={visibility:document.visibilityState,time:Date.now(),initialState:!0};re.push(i)}var t=void 0!==this.handleVisibilityChange,o=t&&void 0!==this.handleVisibilityChange.bind;o?(this.visibilityChangeHandler=this.handleVisibilityChange.bind(this),document.addEventListener("visibilitychange",this.visibilityChangeHandler)):e.ULS.traceTag(595718222,r.WopiPendingApplication,s.Warning,"WindowVisibilityMetrics bad initialization isHandleVisibilityChangeDefined:"+t+", isBindDefined:"+o)},e.prototype.RegisterEventHandler=function(e){this.eventHandlers.push(e)},e.prototype.RemoveEventHandler=function(e){if(e){var i=this.eventHandlers.indexOf(e);this.eventHandlers.splice(i,1)}},e.prototype.Stop=function(){document.removeEventListener("visibilitychange",this.visibilityChangeHandler)},e.prototype.GetVisibilityChangeEvents=function(){return re},e.prototype.handleVisibilityChange=function(){var e={visibility:document.visibilityState,time:Date.now(),initialState:!1};re.push(e);for(var i=0,t=this.eventHandlers;i<t.length;i++){var o=t[i];o&&o(e)}},e}();function pe(e){return{isFeatureEnabled:function(i){return function(e,i){if(!i)return;return i(e)}(i,e)}}}function ce(e){return e.indexOf("we/wordeditorframe.aspx")>=0}function le(e,i){var t=e.applicationUrl.toLowerCase(),o=ce(t),n=t.indexOf("wv/wordviewerframe.aspx")>=0,a=function(e,i,t){if(e.forceFallback)return{required:!0,applicationUrl:e.applicationUrl,forceFallback:!0,reason:ae.forceFallback,ignoreWacFramePostMessages:!1};var o={required:!1,applicationUrl:"",reason:"",ignoreWacFramePostMessages:!1,forceFallback:!1,singleFlushFallback:!1};if(e.disableFallback)return o;if(!i&&e.wopiPrecheckInfo.IrmEnabled)return o.required=!0,o.irmFallback=!0,o.ignoreWacFramePostMessages=!0,o.reason=ae.unifiedIrmEnabledFallback,o.applicationUrl=e.applicationUrl,o;if(e.fnCreatePragueFrame)return o.required=!0,o.singleFlushFallback=!0,o.reason=ae.unifiedSingleFlushFallback,o.applicationUrl=e.applicationUrl,o.ignoreWacFramePostMessages=!1,o;i?(e.wopiInfo||W()===c.IE)&&(o.required=!0,o.singleFlushFallback=!0,o.reason=ae.unifiedSingleFlushFallback,o.applicationUrl=e.applicationUrl,o.ignoreWacFramePostMessages=e.isCreateNew||!1):(o.required=!0,o.ignoreWacFramePostMessages=!0,o.reason=t?ae.unifiedViewActionUrlFallback:ae.unifiedNotEditOrViewActionUrlFallback,o.applicationUrl=e.applicationUrl);return o}(e,o,n);if(a.required){var p={fallbackIsRequired:!0,fallbackReason:a.reason,gotWordEditUrl:o,gotWordViewUrl:n,irmEnabled:e.wopiPrecheckInfo.IrmEnabled,readOnly:e.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:a.ignoreWacFramePostMessages};i.ULS.traceTag(596444182,r.WopiPendingApplication,p.irmEnabled?s.Warning:s.Info,JSON.stringify(p))}else i.ULS.traceTag(596444183,r.WopiPendingApplication,s.Info,"Received input valid for instant boot.");return a}function de(e){return function(e,i){e.WdParams||(e.WdParams={});if(e.WdParams.wd)return;i.substring(1).split("&").filter((function(i){if(0===i.indexOf("wd")){var t=i.split("=");t[0].length>2&&(e.WdParams[t[0]]=t[1])}}))}(e,window.location.search),e}!function(e){e.unifiedSingleFlushFallback="Unified_SingleFlushFallback",e.unifiedIrmEnabledFallback="Unified_IrmEnabled",e.unifiedViewActionUrlFallback="Unified_ViewActionUrl",e.unifiedNotEditOrViewActionUrlFallback="Unified_NotEditOrViewActionUrl",e.forceFallback="Force_Fallback"}(ae||(ae={}));var ge=function(){function e(e,i){this.appFactory=e,this.bootstrapperParameters=i}return e.prototype.GetVersion=function(){return B},e.prototype.GetMinContentVersion=function(){throw new Error("Not implemented")},e.prototype.Prefetch=function(e){if(null!=e&&void 0!==e){var i=document.createElement("link");i.rel="prefetch";var t=e.BootstrapperUrl;".js"!==t.toString().slice(-3)&&(t+=".js"),i.href=t;var o=document.getElementsByTagName("head")[0];null!=o&&void 0!==o&&o.appendChild(i)}},e.prototype.InitializeWopiPending=function(e,i,t,o){var n,p,c,m;try{var w=Date.now();!function(e){if(void 0===e)throw new TypeError("initParams");var i=e.Container;if(void 0===i||void 0===i.appendChild)throw new TypeError("Container");var t=e.SessionInformation;if(void 0===t||void 0===t.HostName||void 0===t.HostSessionId||void 0===t.UserId)throw new TypeError("SessionInformation");var o=e.ApplicationUrl;if(void 0===o||"string"!=typeof o)throw new TypeError("ApplicationUrl");var n=e.WopiPrecheckInfo;if(void 0===n||void 0===n.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===e.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===e.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(e);var P=t,S=void 0;P||(P=(n=function(){var e=new Uint8Array(31),i=function(e){var i={crypto:!1,perfNow:!1,exceptions:[]},t=window.crypto||window.msCrypto;if(t){i.crypto=!0;try{return t.getRandomValues(e),i}catch(e){i.exceptions.push("crypto: "+I(e))}}var o=!1,n=window.performance;try{n&&n.now&&n.now()!==1/0&&(o=!0)}catch(e){i.exceptions.push("perfNow: "+I(e))}for(var a=0;a<e.length;a+=1){try{if(o){i.perfNow=!0;var r=Math.floor(100*n.now())%10;(r<0||r>9)&&(r=0);for(var s=0;s<r;s+=1)Math.random()}}catch(e){i.exceptions.push("Math.random: "+I(e))}e[a]=Math.floor(16*Math.random())}return i}(e),t=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){var o=15&e[t];return t+=1,("x"===i?o:3&o|8).toString(16)})),i]}())[0],S=n[1]),p=i||te.getLogger(P,g(e.ApplicationUrl)+"RemoteUls.ashx");var F=function(e,i){return{container:e.Container,sessionInformation:de(e.SessionInformation),applicationUrl:e.ApplicationUrl,wopiPrecheckInfo:e.WopiPrecheckInfo,applicationCustomSettings:e.ApplicationCustomSettings,diagnostics:{HostInitializeDiagnostics:e.Diagnostics},fnOnInitializeSuccess:e.FnOnInitializeSuccess,fnOnInitializeFailure:e.FnOnInitializeFailure,sessionId:i,applicationBaseUrl:g(e.ApplicationUrl),wopiInfo:e.WopiInfo,forceFallback:!1,disableFallback:!1,isCreateNew:(t=e.ApplicationUrl,o=e.WopiPrecheckInfo.IsNewFile,o||"1"===f(t,"new")),featureManager:pe(e.FnIsFeatureEnabled)};var t,o}(e,P);this.bootstrapperParameters.fnReportSessionStart&&this.bootstrapperParameters.fnReportSessionStart(F),F.forceFallback=this.bootstrapperParameters.forceFallback,F.fnCreatePragueFrame=this.bootstrapperParameters.fnCreatePragueFrame,F.diagnostics.HostInitializeDiagnostics&&(F.diagnostics.HostInitializeDiagnostics.hostInitializeCallTime=w),p.ULS.traceTag(596464283,r.WopiPendingApplication,s.Info,"ApplicationBootstrapper - initializing session. Build version: "+this.GetVersion()),S&&p.ULS.traceTag(595937313,r.WopiPendingApplication,s.Info,JSON.stringify(S)),F&&F.wopiInfo&&F.wopiInfo.AccessToken&&F.wopiInfo.AccessTokenExpiry?(0===F.wopiInfo.AccessToken.length||F.wopiInfo.AccessTokenExpiry.getTime()<=Date.now())&&p.ULS.traceTag(595894621,r.WopiPendingApplication,s.Error,"ApplicationBootstrapper.InitializeWopiPending: AccessToken is not valid, AccessTokenlength: "+F.wopiInfo.AccessToken.length+", AccessTokenExpiry: "+F.wopiInfo.AccessTokenExpiry+", AccessTokenTTL: "+F.wopiInfo.AccessTokenExpiry.getTime()+", DateNow: "+Date.now()):p.ULS.traceTag(595894553,r.WopiPendingApplication,s.Error,"ApplicationBootstrapper.InitializeWopiPending: there are some missing paramters"),window.addEventListener("beforeunload",(function(){return A(p,"OnBeforeUnload",!0)}),{capture:!0}),window.addEventListener("pagehide",(function(){return A(p,"OnPageHide",!0)}),{capture:!0}),window.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&A(p,"VisibilityChange_Hidden",!0)}),{capture:!0});var W=function(e){var i=JSON.parse(JSON.stringify(e));delete i.UserId,delete i.OwnerId,delete i.WdParams;var t=JSON.parse(JSON.stringify(e.WdParams).toLowerCase());return i.WdParams={},["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(e){t[e]&&(i.WdParams[e]=t[e])})),i}(F.sessionInformation);p.ULS.traceTag(596444237,r.WopiPendingApplication,s.Info,JSON.stringify({hostSessionInformation:W})),p.ULS.traceTag(596444238,r.WopiPendingApplication,s.Info,JSON.stringify({hostInitDiagnostics:F.diagnostics.HostInitializeDiagnostics?F.diagnostics.HostInitializeDiagnostics:"N/A"})),this.logFlightInfo(F,p);var T=h(F.fnCreatePragueFrame?window.location.href:e.ApplicationUrl),b=o||new Q(T,p),U=new se(p),M={},L=le(F,p),O=d({},F.diagnostics.HostInitializeDiagnostics,{officeSessionId:F.sessionId,officeBootstrapperVersion:B,hostName:F.sessionInformation.HostName}),E=function(e,i,t,o,n,a,p,c){return function(l){C(e,n,a),v(n,o,s.Info),o.ULS.traceTag(596448985,r.WopiPendingApplication,s.Info,JSON.stringify(e));var d=c(i,o,t,l);try{p(d,e)}catch(e){o.ULS.traceTag(595719171,r.WopiPendingApplication,s.Error,"Exception thrown from host's success callback: "+I(e))}y(o)}}(O,F.sessionId,b,p,M,U,e.FnOnInitializeSuccess,this.appFactory),k=function(e,i,t,o,n){return function(a){C(e,t,o),v(t,i,s.Warning),i.ULS.traceTag(596448986,r.WopiPendingApplication,s.Error,JSON.stringify({error:a,appInitDiagnostics:e}));try{n(a,e)}catch(e){i.ULS.traceTag(595719172,r.WopiPendingApplication,s.Error,"Exception thrown from host's failure callback: "+I(e))}y(i)}}(O,p,M,U,e.FnOnInitializeFailure);"undefined"!=typeof PerformanceResourceTiming&&void 0===PerformanceResourceTiming.prototype.toJSON&&(PerformanceResourceTiming.prototype.toJSON=function(){return{name:this.name,connectStart:this.connectStart,connectEnd:this.connectEnd}});var R=e&&e.BootstrapperUrl;R&&this.periodicPrefetch(R,p),e.FnOnAppModeSwitched&&b.registerMessagePayloadHandler(J.SwitchMode,e.FnOnAppModeSwitched);var x=!1,H=!1,D=F.applicationUrl.toLowerCase();if(-1!==D.indexOf("uiembed")&&(x=e.WopiPrecheckInfo.ReadOnly&&-1!==D.indexOf("wordeditorframe"),H=e.WopiPrecheckInfo.IrmEnabled&&-1!==D.indexOf("wordviewerframe")),this.bootstrapperParameters.useViewerInitializer||L.reason===ae.unifiedViewActionUrlFallback||x||H){(L.reason===ae.unifiedViewActionUrlFallback||x||H)&&e.FnOnAppModeSwitched&&e.FnOnAppModeSwitched({NewMode:"view"}),x&&(F.applicationUrl=function(e){var i=e.toLowerCase();return i=u(i=(i=i.replace("word-edit","word-view")).replace("we/wordeditor","wv/wordviewer"),"WordEditorFailedToLoad","1")}(F.applicationUrl),L={required:!0,applicationUrl:F.applicationUrl,forceFallback:!0,reason:ae.forceFallback,ignoreWacFramePostMessages:!1}),H&&(L.ignoreWacFramePostMessages=!1);var z=new K(F,L,O,p,b,U,M,E,k);return z.Boot(),z}(e.WopiPrecheckInfo.ReadOnly||e.WopiPrecheckInfo.IrmEnabled)&&e.FnOnAppModeSwitched&&e.FnOnAppModeSwitched({NewMode:"view"});var N=L.required?L.applicationUrl:F.applicationUrl;if(R&&this.bootstrapperParameters.preloader&&this.bootstrapperParameters.preloader.shouldPreload(N))try{if(F.featureManager&&F.featureManager.isFeatureEnabled(l.ODC_H2StaticContent_Excel)){p.ULS.traceTag(595645891,r.WopiPendingApplication,s.Info,"HTTP2 preload enabled");var _=(c=R,m=new RegExp("(c[1-5])h?(-)"),c.replace(m,"$1h$2"));this.bootstrapperParameters.preloader.preload(_,p)}else this.bootstrapperParameters.preloader.preload(R,p)}catch(e){p.ULS.traceTag(595943884,r.WopiPendingApplication,s.Error,I(e))}var V=new Z(F,L,O,p,b,M,E,k);return V.Boot(),V}catch(i){return p&&(p.ULS.traceTag(596459925,r.WopiPendingApplication,s.Error,a.AppInitError+": "+I(i)),p.ULS.flushOnClose()),void e.FnOnInitializeFailure({errorType:a.AppInitError,errorObject:i},void 0)}},e.prototype.periodicPrefetch=function(e,i){var t=this;setInterval((function(){t.Prefetch({BootstrapperUrl:e}),i.ULS.traceTag(595895774,r.WopiPendingApplication,s.Info,"Prefetching "+w(e))}),36e5)},e.prototype.logFlightInfo=function(e,i){var t=e.applicationCustomSettings&&e.applicationCustomSettings.InteractiveReadOnlyFlight,o=e.applicationCustomSettings&&e.applicationCustomSettings.InteractiveReadOnlyAAExperiment;t&&i.ULS.traceTag(595953632,r.WopiPendingApplication,s.Warning,"InteractiveReadOnlyFlight: "+t+", InteractiveReadOnlyAAExperiment: "+o)},e}();var fe=function(){function e(e,i,t,o){this.eventHandlers={},this.sessionId=e,this.logger=i,this.innerApplicationFrame=o.innerApplicationFrame,this.postMessenger=t,this.registerPostMessageHandlers(),V()}return e.prototype.GetApplicationType=function(){throw new Error("Not implemented")},e.prototype.GetVersion=function(){return B},e.prototype.GetSessionId=function(){return this.sessionId},e.prototype.RegisterEventHandler=function(e,i){switch(e){case J.AccessibilityLoopComplete:case J.Unloaded:case J.DocumentReboot:case J.WopiInfoFromUrl:if(this.eventHandlers[e])throw new Error("Duplicate registration");this.eventHandlers[e]=i;break;default:this.postMessenger.registerMessagePayloadHandler(e,i)}},e.prototype.RemoveEventHandler=function(e,i){switch(e){case J.AccessibilityLoopComplete:case J.Unloaded:case J.DocumentReboot:case J.WopiInfoFromUrl:if(this.eventHandlers[e]!==i)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.eventHandlers[e];break;default:this.postMessenger.removeMessageHandler(e)}},e.prototype.RegisterErrorHandler=function(e){},e.prototype.RemoveErrorHandler=function(e){},e.prototype.PostCommand=function(e,i){this.postMessenger.postMessageForCommand(this.innerApplicationFrame.contentWindow,e,i)},e.prototype.Dispose=function(e){var i=this;j(e||!1,this.logger,this.postMessenger,this.innerApplicationFrame,(function(){delete i.innerApplicationFrame,i.raiseEvent(J.Unloaded,{})}))},e.prototype.registerPostMessageHandlers=function(){this.postMessenger.registerMessagePayloadHandler(J.AccessibilityLoopComplete,this.handleAccessibilityLoopComplete.bind(this)),this.postMessenger.registerMessagePayloadHandler(O.DocumentReboot,this.handleDocumentRebootMessage.bind(this)),this.postMessenger.registerMessagePayloadHandler(O.SoftReboot,this.handleSoftRebootMessage.bind(this)),this.postMessenger.registerMessagePayloadHandler(O.WopiInfoFromUrlRequest,this.handleWopiInfoFromUrlRequest.bind(this))},e.prototype.raiseEvent=function(e,i){var t=this.eventHandlers[e];t&&t(i||{})},e.prototype.handleAccessibilityLoopComplete=function(e){window.parent!==window&&window.location.href.toLowerCase().indexOf("or=teams")>0&&this.postMessenger.sendPostMessage(window.parent,J.AccessibilityLoopComplete,e),this.raiseEvent(J.AccessibilityLoopComplete,e)},e.prototype.handleDocumentRebootMessage=function(e){this.raiseEvent(J.DocumentReboot,e)},e.prototype.handleSoftRebootMessage=function(e){window.location.reload()},e.prototype.handleWopiInfoFromUrlRequest=function(e){this.raiseEvent(J.WopiInfoFromUrl,e)},e}();var he=function(e){function i(i,t,o,n){var a=e.call(this,i,t,o,n)||this;return a.eventUpdateTimeout=5e3,a.innerApplicationFrame=n.innerApplicationFrame,a.postMessenger=o,a.logger=t,a.eventHandlers={},a.isCore=n.isCore,a.page=n.currentPage,a.zoomLevel=n.zoomLevel,a.pageCount=n.pageCount,a.isDisabled=!a.isCore,a.postMessenger.registerMessagePayloadHandler(J.ZoomChanged,a.handleZoomChange.bind(a)),a.postMessenger.registerMessagePayloadHandler(J.PageChanged,a.handlePageChange.bind(a)),a.postMessenger.registerMessagePayloadHandler(O.FrameStateChanged,a.handleIsDisabled.bind(a)),a.postMessenger.registerMessagePayloadHandler(O.Error,a.raiseError.bind(a)),a}return n(i,e),i.prototype.SetCurrentPage=function(e){var i=this;this.isDisabled?this.raiseError({errorType:a.ApiDisabledError,errorObject:{isCoreMode:this.isCore}}):(this.lastRequestedPage=e,this.innerApplicationFrame&&this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,O.SetCurrentPage,{newPage:this.lastRequestedPage}),window.setTimeout((function(){i.lastRequestedPage!==i.page&&i.logger&&i.logger.ULS.traceTag(596444179,r.WordViewer,s.Info,'Did not receive the page change update. {"RequestedPage": '+i.lastRequestedPage+', "CurrentPage": '+i.page+"}")}),this.eventUpdateTimeout))},i.prototype.GetPageCount=function(){return this.isDisabled&&this.raiseError({errorType:a.ApiDisabledError,errorObject:{isCoreMode:this.isCore}}),this.pageCount},i.prototype.GetCurrentPage=function(){return this.isDisabled&&this.raiseError({errorType:a.ApiDisabledError,errorObject:{isCoreMode:this.isCore}}),this.page},i.prototype.SetZoomLevel=function(e){var i=this;this.isDisabled?this.raiseError({errorType:a.ApiDisabledError,errorObject:{isCoreMode:this.isCore}}):(this.lastRequestedZoomLevel=Number(e.toFixed(2)),this.innerApplicationFrame&&this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,O.SetZoomLevel,{newLevel:this.lastRequestedZoomLevel}),window.setTimeout((function(){i.lastRequestedZoomLevel!==i.zoomLevel&&i.logger&&i.logger.ULS.traceTag(596444180,r.WordViewer,s.Info,'Did not receive the zoom change update. {"RequestedZoom": '+i.lastRequestedZoomLevel+', "CurrentZoom": '+i.zoomLevel+"}")}),this.eventUpdateTimeout))},i.prototype.GetZoomLevel=function(){return this.isDisabled&&this.raiseError({errorType:a.ApiDisabledError,errorObject:{isCoreMode:this.isCore}}),this.zoomLevel},i.prototype.GetIsDisabled=function(){return this.isDisabled},i.prototype.GetApplicationType=function(){return"Word Viewer"},i.prototype.RegisterEventHandler=function(e,i){switch(e){case J.ZoomChanged:case J.PageChanged:case J.IsDisabled:if(this.eventHandlers[e])throw new Error("Duplicate registration");this.eventHandlers[e]=i;break;default:this.postMessenger.registerMessagePayloadHandler(e,i)}},i.prototype.RemoveEventHandler=function(e,i){switch(e){case J.ZoomChanged:case J.PageChanged:case J.IsDisabled:if(this.eventHandlers[e]!==i)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.eventHandlers[e];break;default:this.postMessenger.removeMessageHandler(e)}},i.prototype.RegisterErrorHandler=function(e){this.hostErrorHandler=e},i.prototype.RemoveErrorHandler=function(e){if(this.hostErrorHandler!==e)throw new Error("The handler requested to be removed does not exist");delete this.hostErrorHandler},i.prototype.raiseError=function(e){var i={errorType:"",errorObject:{}};if(i.errorType=e[E.ErrorType],i.errorObject=e[E.ErrorObject],!i.errorType||!i.errorObject)throw new TypeError("Error object is missing errorType or errorObject");this.hostErrorHandler&&this.hostErrorHandler(i)},i.prototype.handleZoomChange=function(e){this.zoomLevel=e[E.NewZoomLevel],this.raiseEvent(J.ZoomChanged,e)},i.prototype.handlePageChange=function(e){this.page=e[E.NewPageNumber],this.raiseEvent(J.PageChanged,e)},i.prototype.handleIsDisabled=function(e){this.isDisabled=e[E.IsDisabled],this.raiseEvent(J.IsDisabled,e)},i}(fe);var ue=!1,me="",we=".min";var Pe=function(e){function i(i){var t=e.call(this,i)||this;return t.resources=[],t.initResources(),t}return n(i,e),i.prototype.initResources=function(){for(var e=0,i=[{domain:"word-edit",url:"wacbootwe.js"},{domain:"officeapps",url:"MicrosoftAjax"+this.debugSuffix+".js"},{domain:"word-edit",url:"Compat"+this.debugSuffix+".js"},{domain:"word-edit",url:"WordEditor"+this.debugSuffix+".js"},{domain:"word-edit",url:"jSanity"+this.debugSuffix+".js"}];e<i.length;e++){var t=i[e],o=this.resourceHostUrl.replace("word-view",t.domain);"/"!==o[o.length-1]&&(o+="/"),o+="we/s/"+this.buildPrefix+"_App_Scripts/"+t.url,this.resources.push(o)}},i}(function(){function e(e){this.resourceHostUrl=h(e),this.buildPrefix=function(){var e=B;if(ue)return e;if(!e)throw new Error("Build number not available");var i=e.split(".");if(4!==i.length)throw new Error("Build number has incorrect format");return i[0]+i[2]+i[3]}(),this.debugSuffix=me,this.minSuffix=we,this.resourceHint=function(){var e=W();if(e===c.Firefox||e===c.IE)return"prefetch";return"preload"}(),this.bootstrapperPageName=w(e)}return e.prototype.preloadResources=function(e){for(var i=0,t=this.resources;i<t.length;i++){var o=t[i];this.preloadResource(o,e)}},e.prototype.preloadResource=function(e,i){var t=document.createElement("link");if(t.setAttribute("crossorigin","anonymous"),t.rel=this.resourceHint,t.href=e,i){t.addEventListener("error",(function(){i.ULS.traceTag(595719107,r.WopiPendingApplication,s.Error,"resource failed to load: "+w(e))}))}t.setAttribute("as","script"),document.head.appendChild(t)},e}()),Se=function(){function e(){}return e.prototype.shouldPreload=function(e){return ce(e)&&!1},e.prototype.preload=function(e){new Pe(e).preloadResources()},e}();t.d(i,"Application",(function(){return Fe})),t.d(i,"Viewer",(function(){return Ie})),t.d(i,"ApplicationEvents",(function(){return J}));var Fe=new ge((function(e,i,t,o){return new fe(e,i,t,o)}),{forceFallback:!1,preloader:new Se}),Ie=new ge((function(e,i,t,o){return new he(e,i,t,o)}),{forceFallback:!0,useViewerInitializer:!0})}]);

